<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PRISMA ABYSS</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22>
    <text y=%22.9em%22 font-size=%2290%22>⚔️</text></svg>">
    
	    <style>
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&display=swap');
        :root {
            --bg-color: #101010; --win-bg: rgba(0,0,0,0.95); --win-border: #fff;
            --text-color: #fff; --accent: #ffd700; --danger: #ff4444; --mp: #4488ff;
            --rare-n: #a0a0a0; --rare-r: #40e040; --rare-sr: #40e0e0; --rare-ur: #e040e0; --rare-ex: #ffff00;
        }
        * { box-sizing: border-box; touch-action: manipulation; user-select: none; }
        body { background: var(--bg-color); color: var(--text-color); font-family: 'DotGothic16', sans-serif; margin: 0; 
            /* JSが動かない場合のフォールバック */
    height: 100vh; 
    /* JSで計算した「本当の高さ」を優先適用 */
    height: calc(var(--vh, 1vh) * 100);
    overflow: hidden; /* ゲーム画面なので基本はhiddenでOK */
    margin: 0;
    padding: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* ★修正: ゲーム全体の枠をレスポンシブ（可変）対応にする */
		#game-container {
			position: relative;
			
			width: 100%;             /* スマホの画面幅に合わせて横幅いっぱいに */
			max-width: 450px;        /* PCやタブレットで大きくなりすぎないよう上限を設定（例: 450px） */
			
			height: 100%;            /* 画面の高さに合わせる */
			max-height: 900px;       /* 縦に長すぎる画面での上限 */
			
			background: #000;
			border: 2px solid #333;
			display: flex;
			flex-direction: column;
			overflow: hidden;
			margin: 0 auto;          /* 画面中央に配置 */
			box-shadow: 0 0 20px rgba(0,0,0,0.5); /* 影をつけて浮き上がらせる */
		}
		
        /* 共通パーツ */
        .scene-layer { flex: 1; position: relative; display: none; flex-direction: column; width: 100%; height: 100%; background: #000; }
        .header-bar { padding: 10px; background: #222; border-bottom: 1px solid #fff; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .btn { background: #333; border: 2px solid #666; color: #fff; padding: 5px 10px; font-size: 12px; cursor: pointer; border-radius: 4px; transition: transform 0.1s, background 0.1s; }
        .btn:active { transform: translateY(2px); background: #555; }
        
        .scroll-area { flex: 1; overflow-y: auto; min-height: 0; }
        .list-item { padding: 10px; border-bottom: 1px solid #444; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.1s; }
        .list-item:hover { background: #222; }
        .list-item:active { background: #444; transform: scale(0.99); }
        .list-item.selected { background: #333; border-left: 3px solid var(--accent); }
        
        .footer-info { padding: 10px; background: #111; border-top: 1px solid #444; white-space: pre-wrap; font-size: 12px; color: #ccc; min-height: 60px; flex-shrink: 0; }
        .tab-bar { display: flex; border-bottom: 1px solid #444; background: #222; flex-shrink: 0; }
        .tab-btn { flex: 1; background: transparent; border: none; color: #888; padding: 10px; font-family: inherit; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #fff; border-bottom: 2px solid var(--accent); }

        /* フィールド画面 */
        #field-scene { display: flex; flex-direction: column; height: 100%; }
        #canvas-wrapper { flex: 1; position: relative; overflow: hidden; border-bottom: 2px solid #fff; background: #333; }
        canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; margin: 0 auto;}
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; }
        .info-box { background: var(--win-bg); border: 2px solid var(--win-border); border-radius: 4px; padding: 8px; margin: 10px; pointer-events: auto; font-size: 14px; width: fit-content; }
        .msg-area { pointer-events: auto; background: var(--win-bg); border-top: 2px solid var(--win-border); padding: 10px; min-height: 80px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .msg-box { font-size: 14px; text-align: center; width: 100%; }
        #action-indicator { display: none; margin-top: 5px; background: var(--accent); color: #000; font-weight: bold; padding: 8px 20px; border-radius: 4px; cursor: pointer; animation: pulse 1s infinite; pointer-events: auto; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- コントローラーエリア --- */
        #controls { height: 260px; background: #222; display: flex; justify-content: space-between; align-items: center; padding: 10px 10px; flex-shrink: 0; border-top: 0px solid #fff; }
        .dpad { display: grid; grid-template-columns: 65px 65px 65px; grid-template-rows: 65px 65px 65px; gap: 5px; grid-template-areas: ". up ." "left . right" ". down ."; }
        .d-up { grid-area: up; } .d-left { grid-area: left; } .d-right { grid-area: right; } .d-down { grid-area: down; }
        .btn-d { background: #333; border: 2px solid #666; color: #fff; font-size: 28px; border-radius: 8px; cursor: pointer; }
        .btn-d:active { background: #555; transform: scale(0.95); }
        .action-pad { display: flex; flex-direction: column; gap: 20px; width: 90px; }
        .btn-act { background: #404080; border: 2px solid #6688ff; color: #fff; height: 60px; border-radius: 8px; font-family: inherit; font-size: 16px; cursor: pointer; }
        .btn-act:active { background: #5050a0; transform: scale(0.95); }

        /* メニュー共通 */
        #menu-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 100; display: none; flex-direction: column; justify-content: center; align-items: center; }
        .menu-window { width: 90%; max-width: 400px; height: 80%; background: #222; border: 2px solid #fff; display: flex; flex-direction: column; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; overflow-y: auto; flex: 1; }
        .menu-btn { background: #333; border: 1px solid #fff; color: #fff; padding: 15px; font-family: inherit; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.1s; }
        .menu-btn:active { transform: translateY(2px); background: #444; }
        
        .sub-screen { position: absolute !important; top: 0 !important; left: 0 !important; width: 100%; height: 100%; background: #101010; z-index: 500; display: none; flex-direction: column; }
        .flex-col-container { display: flex; flex-direction: column; flex: 1; min-height: 0; }

        /* キャラクター表示系 */
        .char-row { display: flex; align-items: center; width: 100%; }
        .char-thumb { width: 48px; height: 48px; background: #444; margin-right:12px; overflow: hidden; border: 1px solid #666; border-radius: 4px; display: flex; align-items: center; justify-content: center; }
        .char-info { flex: 1; min-width: 0; }
        .char-name { font-weight: bold; font-size: 14px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .char-meta { font-size: 11px; color: #aaa; margin-bottom: 4px; }
        .char-stats { font-size: 11px; color: #ddd; display: flex; gap: 8px; flex-wrap: wrap; }
        .tag-party { font-size: 10px; background: var(--accent); color: #000; padding: 1px 4px; border-radius: 2px; margin-right: 5px; }

        /* ステータスバー (画像表示用に拡張) */
        .party-bar { 
            background: #111; 
            border-top: 1px solid #fff; 
            padding: 4px; 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr 1fr; 
            gap: 4px; 
            font-size: 9px; 
            text-align: center; 
            min-height: 110px; /* ★拡張: 画像+名前+ゲージを表示する高さを確保 */
            flex-shrink: 0; 
        }
        .p-box { 
            border: 1px solid #444; 
            padding: 4px 2px; 
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start; /* 上寄せ */
            align-items: center; /* 中央揃え */
            overflow: hidden; 
        }
        .bar-container { width: 100%; height: 4px; background: #333; margin: 1px 0; }
        .bar-hp { height: 100%; background: var(--danger); }
        .bar-mp { height: 100%; background: var(--mp); }
        .p-val { font-size: 9px; color: #ccc; line-height: 1; text-align: right; margin-bottom: 1px; }

        /* ★修正: バトル画面も親要素に合わせて伸縮させる */
		#battle-scene {
			width: 100%;             /* 親要素(game-container)の幅に合わせる */
			display: flex;
			flex-direction: column;
			height: 100%;
			position: relative;
			overflow: hidden;
			background-color: #000;
		}

		/* 子枠（上半分）：ここに背景が表示される */
		#enemy-container {
			width: 100%;
			flex: 1; /* ★重要: これで上部の空きスペース(ログより上の部分)を全て埋める */
			
			display: flex;
			justify-content: center;
			align-items: flex-end; /* モンスターの足元を揃える */
			padding-bottom: 5px;
			z-index: 5;
			
			/* 万が一JSが効かない場合の初期値 */
			background-position: center bottom;
			background-size: cover; 
		}

        /* 敵キャラ表示 */
        .enemy-sprite { 
            width: 90px; height: 90px; 
            background: #444; border: 2px solid #f00; 
            margin: 5px; 
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end; 
            cursor: pointer; position: relative; 
            transition: transform 0.1s;
        }
        .enemy-sprite:active { transform: scale(0.95); }
        .enemy-sprite.dead { opacity: 0.5; filter: grayscale(100%); }
        .enemy-hp-bar { width: 80%; height: 4px; background: #333; margin-top: 2px; }
        .enemy-hp-val { height: 100%; background: var(--danger); transition: width 0.2s; }
        
        /* バトル画面下部の操作パネル */
		#battle-info {
			/* height: 300px;  ← これを削除またはコメントアウト */
			
			/* ★修正: フレックス設定で伸縮可能にする */
			flex: 0 1 300px;      /* 伸長0(伸びない), 圧縮1(縮む), 基準300px */
			min-height: 160px;    /* どんなに縮んでもコマンドと名前欄、ログ1行分は確保 */
			
			background: #000;
			display: flex;
			flex-direction: column;
			border-top: 2px solid #fff;
			
			/* flex-shrink: 0; ← これを削除 (縮めるようにするため) */
		}

        /* ログエリア */
		#battle-log {
			flex: 1;              /* 残りの高さを全て使う */
			min-height: 0;        /* 縮小限界をなくして親に合わせて縮むようにする */
			overflow-y: auto;
			font-size: 14px;
			padding: 8px 12px;
			color: #ddd;
			line-height: 1.4;
			border-bottom: 1px solid #333;
			text-align: left;
		}

        #battle-actor-name { background: linear-gradient(90deg, #003, #005, #003); color: var(--accent); padding: 6px 10px; font-size: 16px; font-weight: bold; border-bottom: 1px solid #555; text-align: center; display: none; }
        
        .cmd-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 8px; height: 110px; }
        .cmd-btn { 
            background: #444; color: #fff; border: 2px solid #888; 
            cursor: pointer; font-size: 16px; font-weight: bold; 
            border-radius: 6px; transition: transform 0.1s; 
        }
        .cmd-btn:active { background: #666; transform: translateY(2px); }
        .cmd-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #battle-target-window, #battle-list-window { position: absolute; left: 10px; right: 10px; bottom: 10px; background: rgba(0,0,0,0.95); border: 2px solid #fff; z-index: 20; display: none; flex-direction: column; }
        #battle-target-window { bottom: 140px; padding: 10px; max-height: 50%; }
        #battle-list-window { top: 60px; bottom: 60px; }
        
        .battle-target-btn { 
            background: #333; border: 1px solid #666; color: #fff; 
            padding: 12px; margin: 2px; cursor: pointer; 
            text-align: left; font-size: 14px; width: 100%; 
            transition: background 0.1s, transform 0.1s;
        }
        .battle-target-btn:active { background: #555; transform: scale(0.98); }

        /* ドロップ確定時のフラッシュ演出 */
        @keyframes flash-screen { 0% { opacity: 0; background: #fff; } 10% { opacity: 0.8; } 100% { opacity: 0; } }
        .flash-effect { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; pointer-events: none; opacity: 0; }
        .flash-active { animation: flash-screen 0.5s ease-out forwards; }
        .log-rare-drop { color: #ff4444; font-weight: bold; text-shadow: 0 0 5px #f00; }

        /* ガチャ演出 */
        .gacha-card-scene { width: 200px; height: 300px; position: relative; transform-style: preserve-3d; transition: transform 0.6s; margin-bottom: 20px; }
        .gacha-card-scene.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid #fff; box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        .card-front { background: #222; transform: rotateY(180deg); padding: 10px; border-color: #444; }
        .card-back { background: radial-gradient(circle, #444, #111); }
        .gacha-result-card { background:#333; border:1px solid #fff; padding:5px; text-align:center; font-size:10px; display: flex; flex-direction: column; align-items: center; min-height: 70px; }
        .new-badge { background:red; color:white; padding:1px 3px; border-radius:3px; font-size:9px; font-weight:bold; }
        #white-out-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 500; display: none; opacity: 0; transition: opacity 0.3s, background-color 0.5s; pointer-events: none; }
        #white-out-overlay.black-turn { background-color: #000 !important; }

        /* ガチャ激アツ演出 */
        #gacha-effect-layer { position: absolute !important; top: 0; left: 0; width: 100%; height: 100%; z-index: 800; pointer-events: none; overflow: hidden; }
        .god-ray-bg { background: radial-gradient(circle, transparent 20%, #000 90%); animation: dim-screen 0.2s forwards; }
        .god-ray-beam { position: absolute; top: 50%; left: 50%; width: 200%; height: 200%; background: conic-gradient(from 0deg, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff, #ff0000); transform: translate(-50%, -50%); opacity: 0; mix-blend-mode: hard-light; animation: ray-spin 2s linear infinite, ray-appear 0.5s ease-out forwards; }
        @keyframes dim-screen { from {background:transparent;} to {background:rgba(0,0,0,0.8);} }
        @keyframes ray-spin { from {transform: translate(-50%, -50%) rotate(0deg);} to {transform: translate(-50%, -50%) rotate(360deg);} }
        @keyframes ray-appear { 0% {opacity:0; scale:0;} 50% {opacity:1; scale:1.5;} 100% {opacity:0; scale:3;} }
        .card-crack-anim { animation: shake-hard 0.5s ease-in-out, flash-white 0.2s 0.5s; }
        @keyframes shake-hard { 0% { transform: translate(0,0) rotate(0); } 25% { transform: translate(-5px, 5px) rotate(-5deg); } 50% { transform: translate(5px, -5px) rotate(5deg); } 75% { transform: translate(-5px, -5px) rotate(-5deg); } 100% { transform: translate(0,0) rotate(0); } }
        @keyframes flash-white { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(10); } }
        .cut-in-text { position: absolute; top: 40%; left: 0; width: 100%; text-align: center; font-size: 60px; font-weight: bold; color: #ffd700; text-shadow: 4px 4px 0 #ff0000; transform: scale(0) rotate(-10deg); animation: text-smash 0.6s cubic-bezier(0.17, 0.67, 0.83, 0.67) forwards; }
        @keyframes text-smash { 0% { transform: scale(3) rotate(-10deg); opacity: 0; } 50% { transform: scale(1) rotate(-10deg); opacity: 1; } 90% { transform: scale(1) rotate(-10deg); opacity: 1; } 100% { transform: scale(1.5) rotate(-10deg); opacity: 0; } }
        
        #gacha-performance { position: absolute !important; top: 0 !important; left: 0 !important; width: 100%; height: 100%; z-index: 600; background: #000; display: none; flex-direction: column; }
        #modal-rates { z-index: 700 !important; }
		
		/* =========================================
		   ガチャ結果画面: レアリティ別特別演出
		========================================= */

		/* --- UR: オーロラのような神秘的な輝き --- */
		.style-aurora {
			/* 背景: 青、紫、緑が混ざり合うグラデーション */
			background: linear-gradient(135deg, #003366, #660066, #006633, #003366);
			background-size: 300% 300%; /* アニメーションのためにサイズを大きく */
			
			/* 枠線と発光: 青緑系の光 */
			border: 1px solid #00ffff;
			box-shadow: 
				0 0 10px rgba(0, 255, 255, 0.7),
				0 0 20px rgba(138, 43, 226, 0.5),
				inset 0 0 15px rgba(0, 255, 255, 0.3);
				
			/* 背景をゆっくり動かすアニメーション */
			animation: aurora-shift 6s ease infinite alternate;
			color: #fff; /* テキストカラーを白系に強制 */
		}
		/* URのレアリティ文字を少し見やすく調整 */
		.style-aurora div:first-child {
			text-shadow: 0 0 5px #00ffff;
		}

		@keyframes aurora-shift {
			0% { background-position: 0% 50%; }
			100% { background-position: 100% 50%; }
		}


		/* --- EX: 赤と金の荘厳な雰囲気 --- */
		.style-majestic {
			/* 背景: 深い赤から黒への重厚なグラデーション */
			background: linear-gradient(to bottom, #8B0000, #2b0000);
			
			/* 枠線: 豪華な金の縁取り */
			border: 2px solid #FFD700;
			
			/* 発光: 強く脈打つ赤と金の光 */
			box-shadow: 
				0 0 15px #ff0000,
				0 0 30px #FFD700,
				inset 0 0 20px rgba(255, 215, 0, 0.5);
				
			/* 全体をゆっくり脈打たせる */
			animation: majestic-pulse 2s ease-in-out infinite alternate;
			color: #FFD700; /* テキストカラーを金色に強制 */
		}
		/* EXのレアリティ文字をさらに際立たせる */
		.style-majestic div:first-child {
			color: #FFD700 !important;
			text-shadow: 1px 1px 2px #000, 0 0 5px #FFD700;
			font-size: 1.1em; /* 少し大きく */
		}

		@keyframes majestic-pulse {
			0% { box-shadow: 0 0 15px #ff0000, 0 0 30px #FFD700, inset 0 0 10px rgba(255, 215, 0, 0.3); }
			100% { box-shadow: 0 0 25px #ff0000, 0 0 50px #FFD700, inset 0 0 30px rgba(255, 215, 0, 0.7); }
		}
		
		/* =========================================
		   ガチャ演出・結果画面：追記専用（不具合修正版）
		========================================= */

		/* 1. カードの見切れ・位置ずれの根本修正 */
		#gacha-performance {
			display: none;
			flex-direction: column;
			justify-content: center !important; /* 垂直中央 */
			align-items: center !important;     /* 水平中央 */
			overflow: hidden !important;
		}

		/* 反転時の位置ずれを防止するため、本体のtransformを安定させる */
		.gacha-card-scene {
			margin: 0 !important;
			transform-origin: center center !important;
			display: flex !important;
			justify-content: center;
			align-items: center;
		}

		/* 2. 裏面：メタリック演出（SSR以上） */
		.card-back.rare-gold, .card-back.rare-rainbow {
			overflow: hidden;
			position: relative;
		}

		/* EXの裏面：赤黒配色 + 金枠 */
		.pre-glow-ex.card-back {
			background: linear-gradient(to bottom, #8B0000, #000000) !important;
			border: 2px solid #FFD700 !important;
		}

		/* URの裏面：オーロラ配色 + 濃いオーロラ枠 */
		.pre-glow-ur.card-back {
			background: linear-gradient(135deg, #003366, #660066, #006633, #003366) !important;
			background-size: 300% 300%;
			border: 2px solid #003366 !important;
			animation: aurora-shift 6s ease infinite alternate;
		}

		/* SSRの裏面：金 + 銀枠 */
		.rare-gold.card-back {
			background: linear-gradient(to bottom, #ffd700, #664400) !important;
			border: 2px solid #c0c0c0 !important;
		}

		/* 斜めのメタリック光沢（カードを動かさないように擬似要素のみを移動） */
		.card-back.rare-gold::after, .card-back.rare-rainbow::after {
			content: "";
			position: absolute;
			top: -150%; left: -150%;
			width: 400%; height: 400%;
			background: linear-gradient(135deg, rgba(255,255,255,0) 42%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0) 58%);
			animation: metallic-sweep 3s infinite linear;
			pointer-events: none;
			z-index: 5;
		}

		@keyframes metallic-sweep {
			from { transform: translate(0, 0); }
			to { transform: translate(30%, 30%); }
		}

		/* 3. 演出中：予兆「もや」演出 */
		/* 枠線(border)をもや(shadow)より前面にするため多層shadowを使用 */
		.pre-glow-ssr { box-shadow: 0 0 30px 5px rgba(255, 215, 0, 0.5) !important; }
		.pre-glow-ur { box-shadow: 0 0 40px 10px rgba(0, 255, 255, 0.6), 0 0 60px 15px rgba(138, 43, 226, 0.4) !important; }
		.pre-glow-ex { box-shadow: 0 0 40px 10px rgba(255, 0, 0, 0.7), 0 0 70px 20px rgba(255, 215, 0, 0.5) !important; }

		/* 4. UR/EX/SSR 表面デザイン（完全配色復元） */

		/* UR: 元の配色を完全復元 + もや + オーロラ枠 */
		.style-aurora {
			background: linear-gradient(135deg, #003366, #660066, #006633, #003366) !important;
			background-size: 300% 300% !important;
			border: 2px solid #00ffff !important; /* オーロラ枠 */
			box-shadow: 0 0 10px rgba(0, 255, 255, 0.7), 0 0 20px rgba(138, 43, 226, 0.5), inset 0 0 15px rgba(0, 255, 255, 0.3) !important;
			animation: aurora-shift 6s ease infinite alternate;
			color: #fff;
		}

		/* EX: 赤黒 + 金枠 + もや */
		.style-majestic {
			background: linear-gradient(to bottom, #8B0000, #000000) !important;
			border: 2px solid #FFD700 !important; /* 金枠 */
			box-shadow: 0 0 15px #ff0000, 0 0 30px #FFD700, inset 0 0 20px rgba(255, 215, 0, 0.5) !important;
			color: #FFD700;
		}

		/* SSR表面: 金 + 銀枠(演出時) */
		.style-gold {
			background: linear-gradient(to bottom, #ffd700, #664400) !important;
			border: 2px solid #c0c0c0 !important;
			box-shadow: 0 0 20px rgba(255, 215, 0, 0.6) !important;
			color: #fff;
		}

		/* 5. 結果画面調整 */
		#gacha-results-list .gacha-result-card {
			width: 64px !important;
			min-height: 180px;
			overflow: visible !important;
			position: relative;
		}
		/* 結果画面のSSR以下は白枠へ */
		#gacha-results-list .style-gold { border: 1px solid #fff !important; }

		@keyframes aurora-shift { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
		
		/* =========================================
		   ガチャ演出・結果画面：最終調整（追記用）
		========================================= */

		/* 1. 裏面：オーロラ配色を表面の指定に合わせる */
		.pre-glow-ur.card-back, .card-back.rare-rainbow {
			background: linear-gradient(135deg, #003366, #660066, #006633, #003366) !important;
			background-size: 300% 300% !important;
			animation: aurora-shift 6s ease infinite alternate;
			border: 2px solid #00ffff !important; 
		}
		
		/* EXの裏面は赤黒 */
        .pre-glow-ex.card-back { 
			background: linear-gradient(to bottom, #8B0000, #000000) !important; 
			border: 2px solid #FFD700 !important; /* 金枠 */
			}

		/* 2. 裏面：メタリック演出をSSR/UR/EXに適用 */
		.card-back.rare-gold, .card-back.rare-rainbow {
			overflow: hidden;
			position: relative;
		}
		.card-back.rare-gold::after, .card-back.rare-rainbow::after {
			content: ""; position: absolute; top: -150%; left: -150%; width: 400%; height: 400%;
			background: linear-gradient(135deg, rgba(255,255,255,0) 42%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0) 58%);
			animation: metallic-sweep 3s infinite linear;
			pointer-events: none; z-index: 5;
		}
		@keyframes metallic-sweep { from { transform: translate(0, 0); } to { transform: translate(30%, 30%); } }

		/* 3. 表面：UR完全配色復元（指示通りのhexコード） */
		.style-aurora {
			background: linear-gradient(135deg, #003366, #660066, #006633, #003366) !important;
			background-size: 300% 300% !important;
			animation: aurora-shift 6s ease infinite alternate;
			border: 1px solid #00ffff !important; /* 表面は明るいオーロラ枠 */
			box-shadow: 
				0 0 10px rgba(0, 255, 255, 0.7),
				0 0 20px rgba(138, 43, 226, 0.5),
				inset 0 0 15px rgba(0, 255, 255, 0.3) !important;
			color: #fff;
		}

		/* 4. もや（オーラ）演出の再定義 */
		.pre-glow-ssr { border: 2px solid #c0c0c0 !important; box-shadow: 0 0 30px 5px rgba(255, 215, 0, 0.5) !important; }
		.pre-glow-ur { box-shadow: 0 0 40px 10px rgba(0, 255, 255, 0.6), 0 0 60px 15px rgba(138, 43, 226, 0.4) !important; }
		.pre-glow-ex { border: 2px solid #ffd700 !important; box-shadow: 0 0 40px 10px rgba(255, 0, 0, 0.7), 0 0 70px 20px rgba(255, 215, 0, 0.5) !important; }

		/* 5. 位置ずれ修正 */
		#gacha-performance { justify-content: center !important; align-items: center !important; }
		.gacha-card-scene { margin: 0 !important; transform-origin: center center !important; }

		@keyframes aurora-shift { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
		
		/* 白銀背景の定義が確実に行われているか確認 */
		#gacha-performance.confirmed {
			background: radial-gradient(circle, #ffffff 0%, #a0a0a0 100%) !important;
			transition: background 0.8s ease-in-out;
		}
		
		/* --- フラッシュ演出の修正 --- */
		#flash-overlay {
			position: fixed !important;
			top: 0; left: 0; width: 100vw; height: 100vh;
			background: #fff;
			z-index: 100000 !important;
			display: none;
			pointer-events: none;
			opacity: 1;
		}
		.flash-multiple { animation: flash-sequence 0.8s forwards; }
		@keyframes flash-sequence { 
			0%, 20%, 40%, 60% { opacity: 0; } 
			10%, 30%, 50% { opacity: 1; } 
			100% { opacity: 0; } 
		}
		
		/* --- SSR: うす暗い金色に調整 --- */
		.card-back.rare-gold { 
			background: linear-gradient(to bottom, #996600, #442200) !important; 
		}
		.style-gold {
			background: linear-gradient(to bottom, #996600, #442200) !important;
			border: 2px solid #c0c0c0 !important;
			box-shadow: 0 0 20px rgba(153, 102, 0, 0.4) !important;
		}
		.pre-glow-ssr { 
			border: 2px solid #c0c0c0 !important; 
			box-shadow: 0 0 30px 5px rgba(153, 102, 0, 0.4) !important; 
		}
		
		/* --- カード表面：内側の線 (2px内側に1px) --- */
		.card-inner-border {
			position: absolute;
			top: 2px; left: 2px; right: 2px; bottom: 2px;
			border: 1px solid #fff; /* デフォルト白 */
			border-radius: 10px;
			pointer-events: none;
			z-index: 2;
		}

		/* レアリティ別の内側の線の色 */
		.style-aurora .card-inner-border, .pre-glow-ur .card-inner-border { border-color: #00ffff !important; }
		.style-majestic .card-inner-border, .pre-glow-ex .card-inner-border { border-color: #FFD700 !important; }
		.pre-glow-ssr .card-inner-border, .style-gold .card-inner-border { border-color: #c0c0c0 !important; }
		
		/* --- 1. R/SR/通常カード：表面の周囲の白枠を強制的に復活 --- */
		/* .card-front に設定されている border-color: #444 を白で上書きします */
		.card-face.card-front:not(.style-aurora):not(.style-majestic):not(.style-gold) {
			border: 2px solid #fff !important;
		}

		/* 結果画面の小さなカード用調整 */
		#gacha-results-list .card-inner-border {
			display: none !important;
		}
		/* 1. SSR以下の全てのカード（SSR, SR, R）を結果画面で白枠に固定 */
		#gacha-results-list .gacha-result-card:not(.style-aurora):not(.style-majestic) {
			border: 1px solid #fff !important;
		}

		/* 2. URの枠線をオーロラ色（指示通りの明るい青緑）に維持 */
		#gacha-results-list .style-aurora {
			border: 1px solid #00ffff !important;
			box-shadow: 
				0 0 10px rgba(0, 255, 255, 0.7),
				0 0 20px rgba(138, 43, 226, 0.5),
				inset 0 0 15px rgba(0, 255, 255, 0.3) !important;
		}

		/* 3. EXの枠線を金色に維持 */
		#gacha-results-list .style-majestic {
			border: 1px solid #FFD700 !important;
			box-shadow: 
				0 0 15px #ff0000, 
				0 0 30px #FFD700, 
				inset 0 0 20px rgba(255, 215, 0, 0.5) !important;
		}

		/* 4. SSRは結果画面では白枠にする（表面の金背景は維持） */
		#gacha-results-list .style-gold {
			border: 1px solid #fff !important;
		}
		
		/* 装備ドロップ：赤黒の超レアフラッシュ */
		.flash-ultra {
			position: fixed; top: 0; left: 0; width: 100%; height: 100%;
			background: linear-gradient(45deg, #000, #f00, #000);
			z-index: 9999; display: none; pointer-events: none;
		}
		/* 赤黒の超レアフラッシュ：白フラッシュと同じ速度へ調整 */
		.flash-ultra-active {
			animation: flash-anim-ultra 0.5s ease-out forwards; /* 1.5sから0.5sへ修正 */
		}
		@keyframes flash-anim-ultra {
			0% { opacity: 0.8; } /* 0.9から0.8へ白と統一 */
			100% { opacity: 0; }
		}
		

    </style>

	<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
	</script>
	
</head>

<body>

<div id="game-container">
    <div id="white-out-overlay"></div>
    <div id="drop-flash" class="flash-effect"></div>
	<div id="drop-flash-ultra" class="flash-ultra"></div>

    <div id="gacha-effect-layer" style="display:none;">
        <div id="effect-bg"></div>
        <div id="effect-text"></div>
        <div id="effect-ray"></div>
    </div>

	
    <div id="flash-overlay"></div>
	
    <div id="field-scene" class="scene-layer">
        <div id="canvas-wrapper">
            <canvas id="field-canvas" width="320" height="320"></canvas>
            <div class="ui-layer">
                <div class="info-box"><span id="loc-name">フィールド</span> <br>G: <span id="disp-gold">0</span> | GEM: <span id="disp-gem">0</span></div>
                <div class="msg-area"><div class="msg-box" id="msg-text">PRISMA ABYSS</div><div id="action-indicator" onclick="App.executeAction()">アクション</div></div>
            </div>
        </div>
        <div id="controls">
            <div class="dpad">
                <button class="btn-d d-up" id="btn-up">▲</button>
                <button class="btn-d d-left" id="btn-left">◀</button>
                <button class="btn-d d-right" id="btn-right">▶</button>
                <button class="btn-d d-down" id="btn-down">▼</button>
            </div>
            <div class="action-pad">
                <button class="btn-act" id="btn-menu">MENU</button>
                <button class="btn-act" style="background:#333; border-color:#666;" id="btn-ok">決定</button>
            </div>
        </div>
    </div>

    <div id="battle-scene" class="scene-layer">
        <button id="btn-auto" class="btn" style="position:absolute; top:10px; right:10px; z-index:10; width:80px;" onclick="Battle.toggleAuto()">AUTO: OFF</button>
        <div id="enemy-container"></div>
        <div class="party-bar" id="battle-party-bar"></div>
        
        <div id="battle-info">
            <div id="battle-log"></div>
            <div id="battle-actor-name"></div>
            <div class="cmd-grid" id="command-root">
                <button class="cmd-btn" onclick="Battle.selectCommand('attack')">こうげき</button>
                <button class="cmd-btn" onclick="Battle.selectCommand('skill')">とくぎ</button>
                <button class="cmd-btn" onclick="Battle.selectCommand('item')">どうぐ</button>
                <button class="cmd-btn" onclick="Battle.selectCommand('defend')">ぼうぎょ</button>
                <button id="btn-run" class="cmd-btn" style="grid-column:span 2;" onclick="Battle.run()">にげる</button>
            </div>
        </div>
        <div id="battle-target-window"><div style="text-align:center; color:#fff; margin-bottom:5px;">対象を選択</div><div id="battle-target-list" style="display:grid; grid-template-columns:1fr 1fr; gap:5px;"></div><button class="btn" style="width:100%; margin-top:5px;" onclick="Battle.cancelSubMenu()">戻る</button></div>
        <div id="battle-list-window"><div class="header-bar"><span id="battle-list-title">選択</span></div><div id="battle-list-content" class="scroll-area" style="padding:5px;"></div><button class="btn" style="margin:10px;" onclick="Battle.cancelSubMenu()">戻る</button></div>
		
		<div id="battle-status-modal" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; z-index:2000; justify-content:center; align-items:center;">
        <div style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7);" onclick="Battle.closeStatusModal()"></div>
        
        <div style="position:relative; width:280px; background:#222; border:2px solid #fff; border-radius:8px; padding:10px; display:flex; flex-direction:column; gap:10px; box-shadow: 0 0 15px rgba(0,0,0,0.8);">
            
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #444; padding-bottom:5px;">
                <div id="modal-char-name" style="font-weight:bold; color:#fff; font-size:16px;">キャラ名</div>
                <button class="btn" style="padding:2px 8px; font-size:12px;" onclick="Battle.closeStatusModal()">×</button>
            </div>

            <div id="modal-char-content" style="font-size:13px; color:#ddd; min-height:100px;">
                </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
                <button class="btn" style="width:60px;" onclick="Battle.switchStatusChar(-1)">＜</button>
                <span style="font-size:11px; color:#888;">切替</span>
                <button class="btn" style="width:60px;" onclick="Battle.switchStatusChar(1)">＞</button>
            </div>
        </div>
		</div>
		
    </div>

    <div id="menu-overlay">
        <div class="menu-window">
            <div class="header-bar"><span>MENU</span> <button class="btn" onclick="Menu.closeMainMenu()">閉じる</button></div>
            <div class="party-bar" id="menu-party-bar"></div>
            <div class="menu-grid">
                <button class="menu-btn" onclick="Menu.openSubScreen('party')">仲間編成</button>
                <button class="menu-btn" onclick="Menu.openSubScreen('equip')">装備変更</button>
                <button class="menu-btn" onclick="Menu.openSubScreen('inventory')">所持装備</button>
                <button class="menu-btn" onclick="Menu.openSubScreen('items')">道具</button>
                <button class="menu-btn" onclick="Menu.openSubScreen('allies')">仲間一覧</button>
                <button class="menu-btn" onclick="Menu.openSubScreen('skills')">スキル</button>
                <button class="menu-btn" onclick="Menu.openSubScreen('book')">魔物図鑑</button>
                <button class="menu-btn" onclick="Menu.openSubScreen('blacksmith')">鍛冶屋</button>
                <button class="menu-btn" style="background:#400040;" onclick="Dungeon.enter()">ダンジョン</button>
                <button class="menu-btn" style="background:#664400;" onclick="Menu.openSubScreen('gacha')">ガチャ</button>
                <button class="menu-btn" style="background:#333;" onclick="App.save(); Menu.msg('保存しました');">セーブ</button>
                
                <button class="menu-btn" style="background:#004444;" onclick="App.downloadSave()">データ出力</button>
                <button class="menu-btn" style="background:#004444;" onclick="App.importSave()">データ読込</button>
                
                <button class="menu-btn" style="background:#500; grid-column:span 2;" onclick="App.returnToTitle()">タイトルへ</button>
            </div>
        </div>
    </div>

    <div id="sub-screen-party" class="sub-screen">
        <div class="header-bar"><span>パーティ編成</span> <button class="btn" onclick="Menu.closeSubScreen('party')">戻る</button></div>
        <div id="party-screen-slots" class="flex-col-container"><div style="padding:5px; text-align:center; font-size:12px; color:#aaa;">スロットを選択</div><div id="party-slot-list" class="scroll-area"></div></div>
        <div id="party-screen-chars" class="flex-col-container" style="display:none;"><div style="padding:5px; background:#333; text-align:center; font-size:12px;">メンバーを選択</div><div id="party-char-list" class="scroll-area"></div></div>
    </div>

    <div id="sub-screen-equip" class="sub-screen">
        <div class="header-bar"><span>装備変更</span> <button class="btn" onclick="Menu.closeSubScreen('equip')">戻る</button></div>
        <div id="equip-screen-char" class="flex-col-container"><div style="padding:5px; text-align:center; font-size:12px;">キャラを選択</div><div id="equip-char-list" class="scroll-area"></div></div>
        <div id="equip-screen-part" class="flex-col-container" style="display:none;"><div id="char-status" style="padding:10px; border-bottom:1px solid #444; font-size:12px;"></div><div style="padding:5px; text-align:center; font-size:12px; background:#333;">部位を選択</div><div id="equip-slot-list" class="scroll-area"></div><button class="btn" style="margin:10px;" onclick="MenuEquip.changeScreen('char')">戻る</button></div>
        <div id="equip-screen-item" class="flex-col-container" style="display:none;"><div style="padding:5px; background:#333; text-align:center; font-size:12px;" id="equip-item-header"></div><div id="equip-list" class="scroll-area"></div><div id="equip-footer" class="footer-info"></div><button class="btn" style="margin:10px;" onclick="MenuEquip.changeScreen('part')">戻る</button></div>
    </div>

    <div id="sub-screen-inventory" class="sub-screen">
        <div class="header-bar"><span>所持装備</span> <span style="font-size:12px;">G:<span id="inventory-gold">0</span></span> <button class="btn" onclick="Menu.closeSubScreen('inventory')">戻る</button></div>
        <div id="inventory-list" class="scroll-area"></div>
        <div id="inventory-footer" class="footer-info"></div>
    </div>

    <div id="sub-screen-items" class="sub-screen">
        <div class="header-bar"><span>道具</span> <button class="btn" onclick="Menu.closeSubScreen('items')">戻る</button></div>
        <div id="item-screen-list" class="flex-col-container"><div id="list-items" class="scroll-area"></div><div id="item-footer" class="footer-info"></div></div>
        <div id="item-screen-target" class="flex-col-container" style="display:none;"><div style="padding:5px; background:#333; text-align:center; font-size:12px;">使用対象を選択</div><div id="list-item-targets" class="scroll-area"></div><button class="btn" style="margin:10px;" onclick="MenuItems.changeScreen('list')">戻る</button></div>
    </div>

    <div id="sub-screen-allies" class="sub-screen">
        <div class="header-bar"><span>仲間一覧</span> <button class="btn" onclick="Menu.closeSubScreen('allies')">戻る</button></div>
        <div id="allies-list-view" class="flex-col-container"><div id="allies-list" class="scroll-area"></div></div>
        <div id="allies-detail-view" class="flex-col-container" style="display:none; background:#1a1a1a;"><div class="tab-bar" id="allies-tabs"></div><div id="allies-detail-content" class="scroll-area"></div><button class="btn" style="margin:10px;" onclick="document.getElementById('allies-detail-view').style.display='none'; document.getElementById('allies-list-view').style.display='flex';">一覧へ戻る</button></div>
    </div>

    <div id="sub-screen-skills" class="sub-screen">
        <div class="header-bar"><span>スキル</span> <button class="btn" onclick="Menu.closeSubScreen('skills')">戻る</button></div>
        <div id="skill-screen-char" class="flex-col-container"><div style="padding:5px; text-align:center; font-size:12px;">使用者を選択</div><div id="skill-char-list" class="scroll-area"></div></div>
        <div id="skill-screen-skill" class="flex-col-container" style="display:none;"><div style="padding:5px; text-align:center; font-size:12px;">スキルを選択</div><div id="skill-list" class="scroll-area"></div><button class="btn" style="margin:10px;" onclick="MenuSkills.changeScreen('char')">戻る</button></div>
        <div id="skill-screen-target" class="flex-col-container" style="display:none;"><div style="padding:5px; text-align:center; font-size:12px;">対象を選択</div><div id="skill-target-list" class="scroll-area"></div><button class="btn" style="margin:10px;" onclick="MenuSkills.changeScreen('skill')">戻る</button></div>
    </div>

    <div id="sub-screen-book" class="sub-screen">
        <div class="header-bar"><span>魔物図鑑</span> <button class="btn" onclick="Menu.closeSubScreen('book')">戻る</button></div>
        <div id="book-list" class="scroll-area"></div>
    </div>

    <div id="sub-screen-blacksmith" class="sub-screen">
        <div class="header-bar"><span>鍛冶屋</span> <button class="btn" onclick="Menu.closeSubScreen('blacksmith')">戻る</button></div>
        <div id="smith-screen-main" class="flex-col-container" style="align-items:center; justify-content:center; gap:20px;">
            <div id="smith-info" style="color:#ffd770;"></div>
            <button class="menu-btn" style="width:200px;" onclick="MenuBlacksmith.selectMode('enhance')">装備強化</button>
            <button class="menu-btn" style="width:200px;" onclick="MenuBlacksmith.selectMode('expand')">スロット拡張</button>
        </div>
        <div id="smith-screen-select" class="flex-col-container" style="display:none;">
            <div id="smith-list" class="scroll-area"></div>
            <div id="smith-footer" class="footer-info"></div>
            <button class="btn" style="margin:10px;" onclick="MenuBlacksmith.changeScreen('main')">戻る</button>
        </div>
    </div>

    <div id="sub-screen-gacha" class="sub-screen">
        <div class="header-bar"><span>ガチャ</span> <span style="font-size:12px;">GEM:<span id="gacha-gem">0</span></span> <button class="btn" onclick="Menu.closeSubScreen('gacha')">戻る</button></div>
		<div id="gacha-menu-view" style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px;">
            <div style="font-size:24px; color:#ffd700;">プレミアムガチャ</div>
            <div style="text-align:center; font-size:12px; color:#ccc;">強力な仲間を召喚しよう！<br>UR, EXは超強力！</div>
            <button class="menu-btn" style="width:200px;" onclick="Gacha.pull(1)">単発 (300 GEM)</button>
            <button class="menu-btn" style="width:200px;" onclick="Gacha.pull(10)">10連 (3000 GEM)</button>
            <button class="btn" style="margin-top:20px;" onclick="Gacha.showRates()">提供割合</button>
        </div>
        <div id="gacha-confirm-view" style="flex:1; display:none; flex-direction:column; align-items:center; justify-content:center; gap:20px;">
            <div id="gacha-confirm-msg" style="font-size:16px; color:#fff; text-align:center;"></div>
            <button class="menu-btn" style="width:200px; background:#d00;" onclick="Gacha.executePull()">召喚する</button>
            <button class="menu-btn" style="width:200px;" onclick="Gacha.cancelPull()">やめる</button>
        </div>
    </div>

    <div id="sub-screen-exchange" class="sub-screen"></div>
    <div id="sub-screen-achievements" class="sub-screen"></div>
    <div id="inn-scene" class="scene-layer"><div class="header-bar"><span>宿屋</span></div></div>
    <div id="medal-scene" class="scene-layer"><div class="header-bar"><span>メダル王の館</span> <span style="font-size:12px;">所持: <span id="medal-count">0</span>枚</span> <button class="btn" onclick="App.changeScene('field')">出る</button></div><div style="padding:10px; text-align:center; font-size:12px;">ちいさなメダルと景品を交換します</div><div id="medal-list" class="scroll-area"></div></div>
    
    <div id="casino-scene" class="scene-layer">
        <div class="header-bar"><span>カジノ</span> <span style="font-size:12px; color:#ffd700;">GEM: <span id="casino-gem">0</span></span></div>
        <div id="casino-area-title" style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:20px;"><button class="menu-btn" style="width:200px;" onclick="Casino.startGame('poker')">ポーカー</button><button class="menu-btn" style="width:200px;" onclick="Casino.startGame('bj')">ブラックジャック</button><button class="btn" onclick="App.changeScene('field')">出る</button></div>
        <div id="casino-area-game" style="flex:1; display:none; flex-direction:column;"><div id="casino-board" style="flex:1; display:flex; flex-direction:column; justify-content:center; padding:10px;"></div><div style="background:#222; padding:10px; text-align:center; min-height:40px;" id="casino-msg"></div><div id="casino-actions" style="padding:10px; display:flex; justify-content:center; gap:10px; background:#111;"></div></div>
    </div>

    <div id="gacha-performance" class="scene-layer">
        <div id="freeze-overlay" style="position:absolute; top:0; left:0; width:100%; height:100%; background:black; z-index:400; display:none;"></div>
        <div id="gacha-stage" style="flex:1; display:flex; align-items:center; justify-content:center;"></div>
        <div style="padding:20px; display:flex; justify-content:center;">
		<button id="btn-gacha-skip" class="btn" onclick="Gacha.skip(event)">スキップ</button></div>
    </div>
    
    <div id="modal-rates" style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:250; display:none; flex-direction:column;">
        <div class="header-bar"><span>提供割合</span> <button class="btn" onclick="document.getElementById('modal-rates').style.display='none'">閉じる</button></div>
        <div id="rates-content" class="scroll-area" style="padding:10px; color:#fff; font-size:12px;"></div>
    </div>
    
    <div id="gacha-result-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:#000; z-index:350; flex-direction:column;">
        <div class="header-bar"><span>召喚結果</span></div>
        <div id="gacha-results-list" class="scroll-area" style="display:grid; grid-template-columns:repeat(5, 1fr); gap:5px; padding:10px;"></div>
        <div style="padding:10px; background:#222; border-top:1px solid #fff; display:flex; flex-direction:column; gap:10px; align-items:center;">
            <div style="color:#ffd700;">所持GEM: <span id="result-gem-display">0</span></div>
            <div style="display:flex; gap:20px;">
                <button class="btn" style="width:100px;" onclick="Gacha.closeResult()">戻る</button>
                <button class="menu-btn" style="width:150px;" id="btn-gacha-retry" onclick="Gacha.retryPull()">もう一度引く</button>
            </div>
        </div>
    </div>

    <div id="assign-modal" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center;">
         </div>

    <div id="menu-dialog-area" style="display:none; position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:2000;">
        <div style="background:var(--win-bg); border:2px solid var(--win-border); padding:20px; border-radius:4px; max-width:90%; width:300px; text-align:center; display:flex; flex-direction:column; gap:15px;">
            <div id="menu-dialog-text" style="font-size:14px; min-height:20px;"></div>
            <div id="menu-dialog-buttons" style="display:flex; justify-content:space-around; gap:10px;"></div>
        </div>
    </div>

</div> 

<script src="assets.js"></script>
<script src="skills.js"></script>
<script src="items.js"></script>
<script src="monsters.js"></script>
<script src="characters.js"></script>
<script src="job_data.js"></script>
<script src="equips.js"></script>

<script src="database.js"></script>
<script src="passiveSkill.js"></script>
<script src="map.js"></script>
<script src="story.js"></script>
<script src="dungeon.js"></script>
<script src="gacha.js"></script>
<script src="facilities.js"></script>
<script src="blacksmith.js"></script>
<script src="main.js"></script>
<script src="battle.js"></script>
<script src="news.js"></script>
<script src="achievements.js"></script>
<script src="menus.js"></script>

<script>
    // 起動処理
    window.onload = () => { 
        if(typeof App !== 'undefined' && App.initGameHub) {
            App.initGameHub();
        } else {
            console.error("App module not found.");
            alert("エラー: データベースまたはスクリプトの読み込みに失敗しました。");
        }
    };
    
    // 実際の高さを計算してCSS変数 --vh にセットする関数
    function setAppHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    // 画面リサイズ時や向きが変わった時に実行
    window.addEventListener('resize', setAppHeight);
    window.addEventListener('orientationchange', setAppHeight);

    // 初回実行
    setAppHeight();

</script>
</body>
</html>
